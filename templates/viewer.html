<!DOCTYPE html>
<html>
  <head>
    <script src="static/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.3.122/build/pdf.min.js"></script>
    <link rel="stylesheet" href="static/css/styles.css">
  </head>
  <script>
    document.addEventListener("DOMContentLoaded", async function() {
      const urlParams = new URLSearchParams(window.location.search);
      const pdfPath = urlParams.get("pdfPath");
      const input = document.querySelector("input[type='file']");
      const viewer = document.querySelector("#pdf-viewer");
      // viewer.style.display = 'none'; // hide the viewer at first
      const container = document.querySelector("#container");
      const p = document.querySelector("p");

      var loading = document.createElement("p");
      loading.style.color = "lightgray";
      loading.style.fontSize = "14px";
      loading.innerHTML = "Calculating embeddings...";
      chat.appendChild(loading);
      container.style.display = "flex";

      try {
        const response = await fetch('/display', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ path: pdfPath }),
        })

        // If the response is not 200, throw an error
        if (response.status !== 200) {
          alert('There was an error. Please try again.');
          throw new Error('Error: ' + response.status);
        }

        const pdfBlob = await response.blob();
        const pdfUrl = URL.createObjectURL(pdfBlob);
        pdfjsLib.getDocument(pdfUrl).promise.then((pdfDoc) => {
          viewer.src = pdfUrl;
          // uploadBtn.style.display = "none";
          // form.style.display = "none";
          // form.style.marginTop = "0px";
          p.style.display = "none";
          // up.style.display = "none";
          viewer.style.display = "block";
        }).catch((error) => {
          console.error(error);
        });
      } catch (error) {
        console.error(error);
      }
    });
  </script>
  <body>
    <div id="container">
        <iframe id="pdf-viewer" class="pdf-viewer" style="border-width: 0"></iframe> 
        <div style="width: 40%; height: 100vh; border: none; background-color: black; display: flex; flex-direction: column; align-items: center; justify-content: space-between;">
            <div id="chat" style="height: 100%; overflow-y: scroll; background-color: black;">
              <!-- Chat messages go here -->
            </div>
            <form style="display: flex; padding-left: 10px; margin-bottom: 10px; width: 100%;">
              <input type="text" name='chat' style="font-size: 14px; flex-grow: 2; padding: 10px; border: none; background-color: black; color: white;" placeholder="Ask a question..." />
              <button id="send" style="background-color: transparent; border: none; padding: 10px 20px;">
                <img src="static/send-icon.png" style="width: 20px; height: 20px;" />
              </button>
            </form>
        </div>          
    </div>
  </body>
</html>
